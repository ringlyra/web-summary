---
title: 'Edit Flows: Flow Matching with Edit Operations'
source: https://arxiv.org/html/2506.09018v1
author:
  - arxiv.org
published: ''
fetched: '2025-06-16T16:13:59.071837+00:00'
tags:
  - codex
  - arxiv
image: 
---

## è¦ç´„

å¤§è¦æ¨¡ãƒ¢ãƒ‡ãƒ«ã§éè‡ªå·±å›å¸°ç”ŸæˆãŒåºƒãŒã‚Šã¤ã¤ã‚ã‚‹ãŒï¼Œå¤šãã¯ãƒˆãƒ¼ã‚¯ãƒ³ä½ç½®ã‚’å›ºå®šã—ã¦æ®µéšçš„ã«åŸ‹ã‚æˆ»ã™æ–¹å¼ã«ä¾å­˜ã—ï¼Œé•·ã•ã®å¤‰åŒ–ã‚’ã†ã¾ãæ‰±ãˆãªã„ã€‚Edit Flowsã¯æŒ¿å…¥ãƒ»å‰Šé™¤ãƒ»ç½®æ›ã®ç·¨é›†æ“ä½œã‚’é€£ç¶šæ™‚é–“ãƒãƒ«ã‚³ãƒ•é€£é–ä¸Šã§ç¢ºç‡çš„ã«é©ç”¨ã—ã¦é›¢æ•£çš„ãªãƒ•ãƒ­ãƒ¼ã‚’å½¢æˆã—ï¼Œç›¸å¯¾ä½ç½®ã«åŸºã¥ãæŸ”è»Ÿãªç³»åˆ—ç”Ÿæˆã‚’å®Ÿç¾ã™ã‚‹ã€‚çŠ¶æ…‹ç©ºé–“ã‚’è£œåŠ©å¤‰æ•°ã§æ‹¡å¼µã—ãŸFlow Matchingå­¦ç¿’ã«ã‚ˆã‚ŠåŠ¹ç‡ã‚ˆãè¨“ç·´ã§ãï¼Œä½ç½®ã®äº‹å‰å®šç¾©ã‚’ã›ãšã«é•·ã•ãŒç•°ãªã‚‹å‡ºåŠ›ã‚’è‡ªç„¶ã«ç”Ÿæˆå¯èƒ½ã¨ãªã‚‹ã€‚å®Ÿé¨“ã§ã¯280Mè¦æ¨¡ã®ç”»åƒã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚„1.3Bè¦æ¨¡ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ»ã‚³ãƒ¼ãƒ‰ã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã§è‡ªå·±å›å¸°å‹ã‚„ãƒã‚¹ã‚¯å‹ã‚’ç€å®Ÿã«ä¸Šå›ã‚‹æ€§èƒ½ã‚’ç¤ºã—ãŸã€‚ç·¨é›†ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¿½è·¡ã™ã‚‹ã“ã¨ã§ç”Ÿæˆéç¨‹ãŒå¯è¦–åŒ–ã§ãï¼Œé«˜é€Ÿæ¨è«–ã‚„ãƒ¢ãƒ‡ãƒ«åœ§ç¸®ã¸ã®å¿œç”¨ã‚‚æœŸå¾…ã•ã‚Œã‚‹ã€‚

## æœ¬æ–‡

Given two sequences x0subscriptğ‘¥0x\_{0}italic\_x start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT and x1subscriptğ‘¥1x\_{1}italic\_x start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT, an alignment can be used to define a precise set of edit operations that transform x0subscriptğ‘¥0x\_{0}italic\_x start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT to x1subscriptğ‘¥1x\_{1}italic\_x start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT. In general, there are many possible alignments for every pair of sequences. For example, below are illustrations of three example alignments between the words â€˜kittenâ€™ and â€˜smittenâ€™ (the most optimal, a sub-optimal padding-to-the-right strategy, and the least optimal):

K Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ I T T E N

â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â€‰ â€‰ â€‰ â€„â€‰ â€‰â€‰â€‰ â€„â€‰

S M I T T E N

K I T T E N Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ

â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â€„â€‰ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â€„â€‰ â€„â€‰ â€„â€‰ â€„â€‰ â€„â€‰ â€„â€‰

S M I T T E N Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ

K I T T E N Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ

â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“ â†“â†“\downarrowâ†“

Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ S M I T T E N

The special token Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ is a *blank* token that is not added to the vocabulary, i.e., it is not part of the input or output of the model. Instead, we will only use it to define an auxiliary process that will provide a training signal for Edit Flows via Theorem [3.1](https://arxiv.org/html/2506.09018v1#S3.Thmthm1 "Theorem 3.1 (Flow Matching with Auxiliary Processes). â€£ 3.2 Training Edit Flows â€£ 3 Edit Flows â€£ Edit Flows: Flow Matching with Edit Operations").
As can be seen, given an alignment, we can recover edit operations as tuples (aâ†’b)â†’ğ‘ğ‘(a\rightarrow b)( italic\_a â†’ italic\_b ) with a,bâˆˆğ’¯âˆª{Îµ}

ğ‘ğ‘
ğ’¯ğœ€a,b\in\mathcal{T}\cup\{{\color[rgb]{.5,.5,.5}\definecolor[named]{%
pgfstrokecolor}{rgb}{.5,.5,.5}\pgfsys@color@gray@stroke{.5}%
\pgfsys@color@gray@fill{.5}\varepsilon}\}italic\_a , italic\_b âˆˆ caligraphic\_T âˆª { italic\_Îµ }, interpreted as an insertion if a=Îµğ‘ğœ€a={\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_a = italic\_Îµ, a deletion if b=Îµğ‘ğœ€b={\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_b = italic\_Îµ, or a substitution if aâ‰ Îµğ‘ğœ€a\neq{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_a â‰  italic\_Îµ and bâ‰ Îµğ‘ğœ€b\neq{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_b â‰  italic\_Îµ.

Formally, let us define the space of aligned sequences as ğ’µ=(ğ’¯âˆª{Îµ})Nğ’µsuperscriptğ’¯ğœ€ğ‘\mathcal{Z}=(\mathcal{T}\cup\{{\color[rgb]{.5,.5,.5}\definecolor[named]{%
pgfstrokecolor}{rgb}{.5,.5,.5}\pgfsys@color@gray@stroke{.5}%
\pgfsys@color@gray@fill{.5}\varepsilon}\})^{N}caligraphic\_Z = ( caligraphic\_T âˆª { italic\_Îµ } ) start\_POSTSUPERSCRIPT italic\_N end\_POSTSUPERSCRIPT. Furthermore, we define the function frm-blanks:ğ’µâ†’ğ’³:subscriptğ‘“rm-blanksâ†’ğ’µğ’³f\_{\text{rm-blanks}}:\mathcal{Z}\rightarrow\mathcal{X}italic\_f start\_POSTSUBSCRIPT rm-blanks end\_POSTSUBSCRIPT : caligraphic\_Z â†’ caligraphic\_X as the operation of stripping away all the Îµğœ€{\color[rgb]{.5,.5,.5}\definecolor[named]{pgfstrokecolor}{rgb}{.5,.5,.5}%
\pgfsys@color@gray@stroke{.5}\pgfsys@color@gray@fill{.5}\varepsilon}italic\_Îµ tokens. Note that since this is a many-to-one function, this implies |ğ’³|<|ğ’µ|ğ’³ğ’µ|\mathcal{X}|<|\mathcal{Z}|| caligraphic\_X | < | caligraphic\_Z |. Following the DFM recipe, we would need to prescribe a coupling Ï€ğœ‹\piitalic\_Ï€ and a conditional CTMC that transports from point to point. Given samples from the source x0âˆ¼pâ¢(x)similar-tosubscriptğ‘¥0ğ‘ğ‘¥x\_{0}\sim p(x)italic\_x start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT âˆ¼ italic\_p ( italic\_x ) and target x1âˆ¼qâ¢(x)similar-tosubscriptğ‘¥1ğ‘ğ‘¥x\_{1}\sim q(x)italic\_x start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT âˆ¼ italic\_q ( italic\_x ) in ğ’³ğ’³\mathcal{X}caligraphic\_X, we can directly construct aligned sequences z0subscriptğ‘§0z\_{0}italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT and z1subscriptğ‘§1z\_{1}italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT in ğ’µğ’µ\mathcal{Z}caligraphic\_Z, e.g., by randomly padding the sequences, or by solving for the optimal alignment that corresponds to the minimal edit distance. This defines a coupling Ï€â¢(z0,z1)ğœ‹subscriptğ‘§0subscriptğ‘§1\pi(z\_{0},z\_{1})italic\_Ï€ ( italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) over the auxiliary variables satisfying the correct marginal distributions

|  |  |  |  |
| --- | --- | --- | --- |
|  | pâ¢(x)=âˆ‘z0âˆ‘z1Ï€â¢(z0,z1)â¢Î´frm-blanksâ¢(z0)â¢(x),qâ¢(x)=âˆ‘z0âˆ‘z1Ï€â¢(z0,z1)â¢Î´frm-blanksâ¢(z1)â¢(x).formulae-sequenceğ‘ğ‘¥subscriptsubscriptğ‘§0subscriptsubscriptğ‘§1ğœ‹subscriptğ‘§0subscriptğ‘§1subscriptğ›¿subscriptğ‘“rm-blankssubscriptğ‘§0ğ‘¥ğ‘ğ‘¥subscriptsubscriptğ‘§0subscriptsubscriptğ‘§1ğœ‹subscriptğ‘§0subscriptğ‘§1subscriptğ›¿subscriptğ‘“rm-blankssubscriptğ‘§1ğ‘¥p(x)=\textstyle\sum\_{z\_{0}}\textstyle\sum\_{z\_{1}}\pi(z\_{0},z\_{1})\delta\_{f\_{% \text{rm-blanks}}(z\_{0})}(x),\qquad q(x)=\textstyle\sum\_{z\_{0}}\textstyle\sum\_% {z\_{1}}\pi(z\_{0},z\_{1})\delta\_{f\_{\text{rm-blanks}}(z\_{1})}(x).italic\_p ( italic\_x ) = âˆ‘ start\_POSTSUBSCRIPT italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT end\_POSTSUBSCRIPT âˆ‘ start\_POSTSUBSCRIPT italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT end\_POSTSUBSCRIPT italic\_Ï€ ( italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) italic\_Î´ start\_POSTSUBSCRIPT italic\_f start\_POSTSUBSCRIPT rm-blanks end\_POSTSUBSCRIPT ( italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT ) end\_POSTSUBSCRIPT ( italic\_x ) , italic\_q ( italic\_x ) = âˆ‘ start\_POSTSUBSCRIPT italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT end\_POSTSUBSCRIPT âˆ‘ start\_POSTSUBSCRIPT italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT end\_POSTSUBSCRIPT italic\_Ï€ ( italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) italic\_Î´ start\_POSTSUBSCRIPT italic\_f start\_POSTSUBSCRIPT rm-blanks end\_POSTSUBSCRIPT ( italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) end\_POSTSUBSCRIPT ( italic\_x ) . |  | (19) |

Then, given z0,z1âˆ¼Ï€similar-to

subscriptğ‘§0subscriptğ‘§1
ğœ‹z\_{0},z\_{1}\sim\piitalic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT âˆ¼ italic\_Ï€, we define a conditional probability path over the augmented space of ğ’³Ã—ğ’µğ’³ğ’µ\mathcal{X}\times\mathcal{Z}caligraphic\_X Ã— caligraphic\_Z

|  |  |  |  |
| --- | --- | --- | --- |
|  | ptâ¢(x,z|x0,z0,x1,z1)=ptâ¢(x,z|z0,z1)=ptâ¢(z|z0,z1)â¢Î´frm-blanksâ¢(z)â¢(x),subscriptğ‘ğ‘¡ğ‘¥conditionalğ‘§  subscriptğ‘¥0subscriptğ‘§0subscriptğ‘¥1subscriptğ‘§1subscriptğ‘ğ‘¡ğ‘¥conditionalğ‘§  subscriptğ‘§0subscriptğ‘§1subscriptğ‘ğ‘¡conditionalğ‘§  subscriptğ‘§0subscriptğ‘§1subscriptğ›¿subscriptğ‘“rm-blanksğ‘§ğ‘¥p\_{t}(x,z|x\_{0},z\_{0},x\_{1},z\_{1})=p\_{t}(x,z|z\_{0},z\_{1})=p\_{t}(z|z\_{0},z\_{1})% \delta\_{f\_{\text{rm-blanks}}(z)}(x),italic\_p start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_x , italic\_z | italic\_x start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_x start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) = italic\_p start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_x , italic\_z | italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) = italic\_p start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_z | italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) italic\_Î´ start\_POSTSUBSCRIPT italic\_f start\_POSTSUBSCRIPT rm-blanks end\_POSTSUBSCRIPT ( italic\_z ) end\_POSTSUBSCRIPT ( italic\_x ) , |  | (20) |

where ptâ¢(z|z0,z1)subscriptğ‘ğ‘¡conditionalğ‘§

subscriptğ‘§0subscriptğ‘§1p\_{t}(z|z\_{0},z\_{1})italic\_p start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_z | italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) is a token-wise mixture probability path ([8](https://arxiv.org/html/2506.09018v1#S2.E8 "Equation 8 â€£ 2.2 Discrete Flow Matching â€£ 2 Preliminaries â€£ Edit Flows: Flow Matching with Edit Operations")).
A conditional rate that transports along the augmented probability path is then given by (see LemmaÂ [A.2](https://arxiv.org/html/2506.09018v1#A1.Thmtheorem2 "Lemma A.2 (Rates that generate ğ‘_ğ‘¡â¢(ğ‘¥,ğ‘§)=ğ›¿_{ğ‘“â¢(ğ‘§)}â¢(ğ‘¥)â¢ğ‘_ğ‘¡â¢(ğ‘§)). â€£ Appendix A Theorems and proofs â€£ 6 Conclusion â€£ 5 Experiments â€£ Edit Flows: Flow Matching with Edit Operations"))

|  |  |  |  |
| --- | --- | --- | --- |
|  | utâ¢(x,z|xt,zt,z0,z1)=Î´frm-blanksâ¢(z)â¢(x)â¢âˆ‘i=1NÎºË™t1âˆ’Îºtâ¢(Î´z1iâ¢(zi)âˆ’Î´ztiâ¢(zi))â¢Î´ztâ¢(zÂ¬i)subscriptğ‘¢ğ‘¡ğ‘¥conditionalğ‘§  subscriptğ‘¥ğ‘¡subscriptğ‘§ğ‘¡subscriptğ‘§0subscriptğ‘§1subscriptğ›¿subscriptğ‘“rm-blanksğ‘§ğ‘¥superscriptsubscriptğ‘–1ğ‘subscriptË™ğœ…ğ‘¡1subscriptğœ…ğ‘¡subscriptğ›¿superscriptsubscriptğ‘§1ğ‘–superscriptğ‘§ğ‘–subscriptğ›¿superscriptsubscriptğ‘§ğ‘¡ğ‘–superscriptğ‘§ğ‘–subscriptğ›¿subscriptğ‘§ğ‘¡superscriptğ‘§ğ‘–u\_{t}(x,z|x\_{t},z\_{t},z\_{0},z\_{1})=\delta\_{f\_{\text{rm-blanks}}(z)}(x)% \textstyle\sum\_{i=1}^{N}\tfrac{\dot{\kappa}\_{t}}{1-\kappa\_{t}}(\delta\_{z\_{1}^{% i}}(z^{i})-\delta\_{z\_{t}^{i}}(z^{i}))\delta\_{z\_{t}}(z^{\neg i})italic\_u start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_x , italic\_z | italic\_x start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) = italic\_Î´ start\_POSTSUBSCRIPT italic\_f start\_POSTSUBSCRIPT rm-blanks end\_POSTSUBSCRIPT ( italic\_z ) end\_POSTSUBSCRIPT ( italic\_x ) âˆ‘ start\_POSTSUBSCRIPT italic\_i = 1 end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_N end\_POSTSUPERSCRIPT divide start\_ARG overË™ start\_ARG italic\_Îº end\_ARG start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT end\_ARG start\_ARG 1 - italic\_Îº start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT end\_ARG ( italic\_Î´ start\_POSTSUBSCRIPT italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_i end\_POSTSUPERSCRIPT end\_POSTSUBSCRIPT ( italic\_z start\_POSTSUPERSCRIPT italic\_i end\_POSTSUPERSCRIPT ) - italic\_Î´ start\_POSTSUBSCRIPT italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_i end\_POSTSUPERSCRIPT end\_POSTSUBSCRIPT ( italic\_z start\_POSTSUPERSCRIPT italic\_i end\_POSTSUPERSCRIPT ) ) italic\_Î´ start\_POSTSUBSCRIPT italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT end\_POSTSUBSCRIPT ( italic\_z start\_POSTSUPERSCRIPT Â¬ italic\_i end\_POSTSUPERSCRIPT ) |  | (21) |

Note that this rate only transports between sequences xtâ†’xâ†’subscriptğ‘¥ğ‘¡ğ‘¥x\_{t}\rightarrow xitalic\_x start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT â†’ italic\_x that *differ by one edit operation*, perfectly mapping to Edit Flowâ€™s transitions ([13](https://arxiv.org/html/2506.09018v1#S3.E13 "Equation 13 â€£ 3.1 Edit Flows: a continuous-time Markov chain using edit operations â€£ 3 Edit Flows â€£ Edit Flows: Flow Matching with Edit Operations"))-([15](https://arxiv.org/html/2506.09018v1#S3.E15 "Equation 15 â€£ 3.1 Edit Flows: a continuous-time Markov chain using edit operations â€£ 3 Edit Flows â€£ Edit Flows: Flow Matching with Edit Operations")).
Applying Theorem [3.1](https://arxiv.org/html/2506.09018v1#S3.Thmthm1 "Theorem 3.1 (Flow Matching with Auxiliary Processes). â€£ 3.2 Training Edit Flows â€£ 3 Edit Flows â€£ Edit Flows: Flow Matching with Edit Operations"), the marginal rate that transports from pâ¢(x)ğ‘ğ‘¥p(x)italic\_p ( italic\_x ) to qâ¢(x)ğ‘ğ‘¥q(x)italic\_q ( italic\_x ) can be expressed as

|  |  |  |  |
| --- | --- | --- | --- |
|  | utâ¢(x|xt)=âˆ‘zğ”¼ptâ¢(z0,z1,zt|xt)â¢utâ¢(x,z|xt,zt,z0,z1),subscriptğ‘¢ğ‘¡conditionalğ‘¥subscriptğ‘¥ğ‘¡subscriptğ‘§subscriptğ”¼subscriptğ‘ğ‘¡subscriptğ‘§0subscriptğ‘§1conditionalsubscriptğ‘§ğ‘¡subscriptğ‘¥ğ‘¡subscriptğ‘¢ğ‘¡ğ‘¥conditionalğ‘§  subscriptğ‘¥ğ‘¡subscriptğ‘§ğ‘¡subscriptğ‘§0subscriptğ‘§1\displaystyle u\_{t}(x|x\_{t})=\textstyle\sum\_{z}\mathbb{E}\_{p\_{t}(z\_{0},z\_{1},z% \_{t}|x\_{t})}u\_{t}(x,z|x\_{t},z\_{t},z\_{0},z\_{1}),italic\_u start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_x | italic\_x start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ) = âˆ‘ start\_POSTSUBSCRIPT italic\_z end\_POSTSUBSCRIPT blackboard\_E start\_POSTSUBSCRIPT italic\_p start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT | italic\_x start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ) end\_POSTSUBSCRIPT italic\_u start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT ( italic\_x , italic\_z | italic\_x start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 0 end\_POSTSUBSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT ) , |  | (22) |

which we learn using a Bregman divergence as the training loss (see [SectionÂ A.1](https://arxiv.org/html/2506.09018v1#A1.SS1 "A.1 A Bregman divergence as the training loss for Edit Flows â€£ Appendix A Theorems and proofs â€£ 6 Conclusion â€£ 5 Experiments â€£ Edit Flows: Flow Matching with Edit Operations")), simplifying to

where xâ¢(zt,i,z1i)=frm-blanksâ¢(zt1,â€¦,ztiâˆ’1,z1i,zti+1,â€¦,ztN)ğ‘¥subscriptğ‘§ğ‘¡ğ‘–superscriptsubscriptğ‘§1ğ‘–subscriptğ‘“rm-blankssuperscriptsubscriptğ‘§ğ‘¡1â€¦superscriptsubscriptğ‘§ğ‘¡ğ‘–1superscriptsubscriptğ‘§1ğ‘–superscriptsubscriptğ‘§ğ‘¡ğ‘–1â€¦superscriptsubscriptğ‘§ğ‘¡ğ‘x(z\_{t},i,z\_{1}^{i})=f\_{\text{rm-blanks}}(z\_{t}^{1},\dots,z\_{t}^{i-1},z\_{1}^{i%
},z\_{t}^{i+1},\dots,z\_{t}^{N})italic\_x ( italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT , italic\_i , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_i end\_POSTSUPERSCRIPT ) = italic\_f start\_POSTSUBSCRIPT rm-blanks end\_POSTSUBSCRIPT ( italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT 1 end\_POSTSUPERSCRIPT , â€¦ , italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_i - 1 end\_POSTSUPERSCRIPT , italic\_z start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_i end\_POSTSUPERSCRIPT , italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_i + 1 end\_POSTSUPERSCRIPT , â€¦ , italic\_z start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT start\_POSTSUPERSCRIPT italic\_N end\_POSTSUPERSCRIPT ), which directly corresponds to one of the edit operations in ([13](https://arxiv.org/html/2506.09018v1#S3.E13 "Equation 13 â€£ 3.1 Edit Flows: a continuous-time Markov chain using edit operations â€£ 3 Edit Flows â€£ Edit Flows: Flow Matching with Edit Operations"))-([15](https://arxiv.org/html/2506.09018v1#S3.E15 "Equation 15 â€£ 3.1 Edit Flows: a continuous-time Markov chain using edit operations â€£ 3 Edit Flows â€£ Edit Flows: Flow Matching with Edit Operations")). This loss can be interpreted as minimizing all the output rates of the model, while having a weighted cross-entropy over edit operations that bring xtsubscriptğ‘¥ğ‘¡x\_{t}italic\_x start\_POSTSUBSCRIPT italic\_t end\_POSTSUBSCRIPT closer to x1subscriptğ‘¥1x\_{1}italic\_x start\_POSTSUBSCRIPT 1 end\_POSTSUBSCRIPT.

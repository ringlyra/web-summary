---
title: メルカリにおけるデータアナリティクス AI エージェント「Socrates」と ADK 活用事例
source: https://speakerdeck.com/na0/merukariniokerudetaanariteikusu-ai-eziento-socrates-to-adk-huo-yong-shi-li
author: Naofumi Yamada
published: ''
fetched: '2025-06-10T13:57:59.699587+00:00'
tags:
- codex
- ai
- analytics
- google-adk
- mercari
image: https://files.speakerdeck.com/presentations/62baa2a3163e42c2ba88a8e9625eb1e3/slide_0.jpg?35407186
---

## 要約

メルカリでは、膨大な取引データ活用に専門知識が必要で、分析依頼の遅延や定型作業の負荷が課題となっていた。そこで**Socrates**と名付けられた**データアナリティクスAIエージェント**を開発し、自然言語で誰もがデータと対話できるようにした。**Google ADK**を活用してBigQueryやPythonなどのツール群と連携し、ユーザーの履歴や文脈を保持しながら複雑な分析を自動化。設計ではイベント履歴やメモリ管理、外部アーティファクトの保管などADKの各機能を組み合わせ、分析セッションを再現可能にしている。開発・運用ではプロンプトや周辺資産の整備が不可欠だが、エンタープライズ向けに高い柔軟性を提供できると報告している。

## 本文

メルカリにおけるデータアナリティクス
Al エージェント 「Socrates」 と ADK 活用事例

Naofumi Yamada (@④naO0fu3y)
2025-06-10

mercQri

| 注意書き

e この資料は意図的に大量の文字で構成されています
o Google NotebookLM を使って探索することを想定しています
mm MindMap を使って構成を見ながら、資料と対話できます

メルカリSocratesとADK活用事例
Basedon1s

Naofumi Yamada @⑦naO0fu3y

Agent Engineer / Mercari BI Product
Google Developer Expert (Google Cloud)
グループミッション mercori

あらゆる価値を循環させ、あらゆる人の可能性を広げる

“Circulate all forms of value to unleash the potential in all people"

FACTBOOK

会社概要

mercari

メルカリグループは、株式会社メルカリと、その連結子会社で構成されています。

| japanRegion 。 ] an Region

Marketplace

GrCQT| 株式会社メルカリ

=設立 2013年2月1日

=業内容 スマートフォン向けフリマアプリ
「メルカリ」の企画・開発・運営

=所在地 〒106-6118東京都洪区六本木6-10-1
六本木ヒルズ森タワー

=損 東京、 福岡、大阪

=代表季行役 CEO 山田信朗

SVPof Japan Region 山本真人
員 CEO Marketplace 骨人吉

rne rpQY 株式会社メルペイ

2017年11月20日
②金融副業
永沢岳志

mercoin mxルコイン

⑥2021年4月28日
②暗号資産・ブロックチェーン
中村春太

MERCARI aunees

2014年1月

US版メルカリの企画・開発・運営
山田進太朗

@Palo Alto. California

ウン 株式会社島

@1991年1月1日”イトラーズ エーシ
②③フットポールクラブ電営

③小泉文明

@茨城県立カシマサッカースタジアム
指定管理茨城県鹿嶋市 粟生東山2887番地

Mercari Software Technologies
India Private Limited
インド開発拠点
@2022年6月
②インターネットサービス開発
Carlos Donderis (取締役 Managing Director)
@Bangalore, Karnataka, India

③設立 の事業内容 ③CEO 所在地

FACTBOOK

株式会社メルカリ 概要

会社設立日

2013年2月1日

時

オフィス
東京、福岡、大阪

Palo Alto、Bangalore

従業員数
2,190名 (連結)

mercari

| 本日のゴール

01 エンタープライズ Al エージェント開発の実践知を共有
02 Google ADK の可能性を Socrates を例として実感

03 Alエージェントプロジェクト推進へのヒントと刺激を提供
| アジェンダ てSocrates 開発と ADK 活用の物語て

【挑戦】メルカリのデータ活用課題と Socrates 誕生

【Socrates 詳解】 データアナリティクス Al エージェントの全狐

【背景理解】 なぜ Al エージェントなのか ? なぜ自社開発なのか ?
【道具】Google ADK 登場と Socrates アーキテクチャ

【学びの軌跡】 技術選定とエコシステム構築の戦略

【実践知】 エンタープライズ Al エージェント運用のリアル

【未来展望】 ADK の進化への期待

【まとめ】 成功の鍵と教訓

のののだのピロビ

1. 【挑戦】メルカリのデータタ活用課題
   と Socrates 誕生

メルカリが抱えていた課題と
データアナリティクス Al エージェント「Socrates」 開発の背景

| メルカリが直面していたデータ活用の壁 (1/2)

s 「データの宝庫」メルカリ: 膨大なお客様の行動、取引、商品データ。 ま
さにビジネス成長の源泉。
s しかし、活用への「壁」:
o SQL やデータタ構造の専門知識の必要性: データの発見 / 権限申請 / 構
造理解が容易ではない。
o データアナリストのボトルネック化: 分析依頼への対応に時間がかか
り、意思決定の遅延や機会損失が発生。
| メルカリが直面していたデータ活用の壁 (2/2)

e 直面していた具体的な課題:

o データタ分析の属人化・サイロ化: 特定アナリストへの問い合わせ集
中、分析ノウハウ共有の困難さ。

o 定型業務の負荷: 定型的なデータ抽出・可視化作業にアナリストの時
間が割かれる。

o 探索的分析への時間不足: 要因深掘り、仮説検証、施策効果測定など
の複雑な分析に十分な時間を割けない。

o ビジネスサイドのデータアクセス障壁: SOL の習熟が必要で、非専門
家にはハードルが高い。 結果、データに基づいた迅速な意思決定が阻
害されることも。

e 「誰もが、もっと手軽に、データと対話できたら ?」

座 mercori

1
| Socrates 構想 : Al による分析支援への期待

e Socrates 構想
o 「優秀なデータアナリストと対話するかのように、誰もが自然言語で
データタと会話し、必要な情報を引き出し、洞察を得られる仕組み」
e Al による分析支援への期待と、従来の LLM 単体アプローチの限界認識
o 単純な Text2SQL+一間一答では、実務の複雑なプロセスに対応困難
o お ーーキタクエリークエーー SOLの生成に挑戦し
衣 ker Deck

IAl エージェント vs Text2SQL
AI エージェントは複雑なタスクをこなせる半面、構築や運用が複雑

特徴 Al エージェント Socrates Text2SQL

主目的 対話による分析・仮説生成・洞察獲得、タスク自動化 SQL 自動生成

柔軟性 〇高 (多様な質問、非定型分析に対応 ) ※低 (定型クエリ中心)

知識源 〇大量のテーブルに関する情報、 RAG、ドキュメント、過 | 淡限られたテーブルに関する情
去の対話履歴、コード 報

ツール連携 | 〇多様なツールと連携 (BigQuery, Python, API 等) ※ほぼ無し

構築・運用 | 芝プロンプト、ツール、周辺資産整備など多岐に渡る | 〇プロンプト改善が主

座 mercori セ 2. 【Socrates 詳人角】 データアナリ
ティクス Al エージェントの全狐

Socrates が何を目指し、何ができるのか、その具体的な機能と動作イメージ

14
| Socrates の分析ジャーニー (デモ) (1/2)
UI イメージ: Streamlit ベースのチャットインターフェース

Aboutsocrates (Bets)

15
| Socrates の分析ジャーニー (デモ) (2/2)

e 上只

O O O 』

体的な対話例:
「先月の XX カテゴリの GMV 推移をグラフで教えて。理由も。」
「GMVが急増した要因は ? 関連する可能性のある指標も教えて。」

「メルカリの全額補償に関するプレスリリースの X (|旧 Twitter) での
反応を教えて」

16
| Socrates が実現する世界 : 目的と提供価値

e Socrates とは: データアナリストやビジネスユーザー (PdM、マーケター
等) 向けの社内データアナリティクス Al エージェント。

e 目的
o デー人分析の民主化: 専門知識の有無によらず、誰もがデータにアク
セスし、洞察を得られるように。
o 意思決定の迅速化: 分析にかかる時間を大幅に短縮。
o データドリブンな文化醸成 データに基づく議論と行動を促進。
| Socrates の主要機能

準備

e 分析要求の理解 / 具体化

\*。 関連データ / ドキュメント
の提案と探索

e 仮説提案

実行

e BigQuery クエリの生成 /
実行

- Python コードによる高度
  な加工 / 分析 / 可視化

活用

- 結果の解釈と洞察の提示
- レポート自動生成支援

18
| Socrates との他の社内ツールとの共存関係
他ツールと協調して、 良いとこどりを実現

社内データプロダクト 分析自由度 SQL スキル | ドメインデータ知識 | 環境構築

Al エージェント “Socrates” 高い 〇不要 〇不要 〇不要 +ガードレール

Bl レポート XX 〇不要 〇條要 〇イイ要

Conversational Analytics ^ 〇不要 ^ O人不要

/ Looker Explores
/ Gemini in BigQuery

Cursor+ MCPs 〇高い 〇不要 ム X
加工済みデータ ^ ^ 〇條要 〇邊要
生データ 〇高い XX XX 〇不要

座 mercori 3. 【育景理解】 なぜ Al エージェント
なのか ? なぜ自社開発なのか ?

Socrates のような Al エージェントが登場した技術的背景と、メルカリの戦略
的判断

20
| Al エージェントの定義

es Alエージェントとは:自ら「推論」し「行動」することで目標を達成する
システム。 近年ではさらに高度で多様な特徴を持つように進化。
e Alエージェントの主要な特徴
o 推論(Reasoning): 論理的に結論を導き、推論して、問題を解決する
行動 (Acting): 計画や入力に基づき、環境に行動を起こす
観察(0bserving): 環境を認識・把握し、意思決定に活かす
計画 (Planning): 目標達成のための手順を立案し、行動方針を決める
協調 (Collaborating): 人間や他の Al と連携し、目標を達成する
自己改善 (Self-refining): 経験から学び、継続的に性能を向上させる

What are Al agents? Definition、examples. and types | Google Cloud より要約

O O OO O

座 mercori 同
| LLM の進化と限界、Al エージェントの必要性

e 大規模言語モデル (LLM) の飛躍的進化 (例: Gemini 2.0 Pro)
o 自然言語理解・生成が、実用的な速度、精度、コストで利用可能に。
o 高度な質疑応答、文章要約、翻訳、多様なコンテンツ作成、コード生

成支援など、ビジネス応用が急速に拡大。

e LLM 単体では実世界の複雑な問題解決には限界:
o 受動性: プロンプトへの応答のみで、自律的なタスク遂行は困難。
o 知識の固定化: 社内 DB 等の最新情報へヘアクセスできない。
o 行動の制約: 外部システム操作などは実行不可。

e 愛LLMの「思考」を、現実世界での具体的な「行動」に繋げ、より高度な
タスクを自律的に実行させるAIエージェントへの期待が高まっている。

座 mercori

22
| なぜ Socrates を自社開発したのか ? (1/2)

es タイミング (2025 年 3 月時点)

o データタ活用Alプロジェクトの再燃と経営層の期待。

o 高品質なデータマート (PJ 名: Basic Tables) の完成。

o 高性能な LLM の登場。実用的な速度と精度。

o LangGraph のような Al エージェント構築ライブラリ。
mm 2日でLangGraph ベースの初期デモが稼働。「Al エージェント

によるデータダ分析支援」の有効性を確信。

o エンタープライズレベルで信頼でき、メルカリの複雑なデータ環境と

要求に応えられる汎用的なデータ分析 Al エージェントがなかった。
| なぜ Socrates を自社開発したのか ? (2/2)

e 「周辺資産」への早期投資の意図

o Alエージェントのコア技術は急速にコモディティ化する可能性。

o 真の競争優位性は、他社が模信困難な「周辺資産」 (構造化データ、
非構造化レッジ、業務プロセス、評価基盤) にある。

o Socrates を自社開発し運用することで、これらの周辺資産の価値を早
に 全社的な整備・強化を加速させる「触媒」としての役割
を期待。

o 目指すのは「AIAgent Ready」な組織と環境の確立
Skip

| Socrates の初期検証 : PoC スコープ (1/2)

e 2
o 理由:

品 最大価値の想起: 限定的でもエンドツーエンドで分析プロセスが
自動化される体験で、Al エージェントが青来提供しうる最大価値
を具体的にイメージさせる。

呈 コア技術の実現性証明 : 最も重要な「自然言語 一 SQL 分析結
果」のフローが、高品質データに対して機能することを示す。

mm 具体的フィードバックの獲得 : 「動くもの」があることで、ユー
ザーからの質の高いフィードバックを得やすい。

呈 品質保証期間の最小化 : 最初は「寿命が短い」プロセスにフォー
カスして、リリースサイクルを高速化。
Skip

| Socrates の初期検証 : PoC スコープ (2/2)

e Socrates PoC の具体的スコープ :
o 玖貞データリーズの恨宙\*
呈 高品質データマート「Basic Tables」のみを対象
o 対象分析プロセスの限定 :
呈 コーザーの分析ニーズ特定
号 関連する Basic Tables からのテーブル選択
号 SOLクエリ自動生成と BigQuery での実行
号 分析結果の表形式での描画
o 対象外とした機能 :
号 複雑な対話、グラフ描画、高度な統計分析、広範なデータソース
への対応など。
e 成果と学び: 「優秀なアナリストと対話するようにデータ分析が進む」 大
きな期待感と、データ整備の重要性を伝えた。

座 mercori っ6
Skip

| Socrates の全社リリース
PoC から価値を上げるために必要な精度 / 機能に関する追加検証を実施中

(Breadth) 分析範囲 (Depth) 分析深度 (Credibility) 信頼性

e BigQuery 全域 e 可視化機能 s ハルシネーションの抑制
e 権限申請案内 e 仮説検証の案内 e 説明性の高い UI
e ツール
o ガードレールの整備
o 権限最小化
Skip

| Al エージェントが真価を発揮する領域 (1/3)

Socrates の価値曲線:
精度増加に対して、ビジネス価
値が急増するタスクを狙う

Value

1アナ リストの代替 三 Max Value

Socrates (リリース)
人間 (Lv. 2)
Socrates (PoC)

人間 (Lv. 1) ニ MVA
Accuracy

> テ

28
Skip

| Al エージェントが真価を発揮する領域 (2/3)

e 「非決定論的」であることが強みになる&許容できる
o Alエージェントは同じ入力に対して、同じ出力や行動になるとは限ら
ない。
e 非決定論性が「強み」となる領域
o 探索や仮説生成: 答えが決まっていない間いに対し、様々な角度から
青報を収集し、多様な可能性を探る。
o 柔軟な対応: 曖昧な指示や状況の変化に対して、文脈に応じた臨機応
変な判断や行動を行う。
o 創造性やブレインストー

77

ング: 新しいアイデアや洞察を生み出す。
Skip

| Al エージェントが真価を発揮する領域 (3/3)

e 「Al エージェントの提供できる価値」 <-+「成果物の寿命」 ?
o (得意) 短命な成果物 : 作成された直後に価値が最大となり、時間経
過と共に急速に価値が低下するもの。
号 例:日次分析レポート、リアルタイムな顧客問い合わせへの一次
答、市場の瞬間的なトレンド把握
o (苦手) 長寿な成果物 : 長期間にわたり正確性や信頼性が求められる
もの。
品 例: 会計監査報告書、製品の安全基準ドキュメント、学術論文*
画 (*学術論文は書けることも指摘されているが、高度な実装が必要)
e ラテデータ分析は「寿命の短い成果物」として向いているタスクの一つ
o 検証レポートなどは、寿命が長いものに適用する場合は工夫が必要

座 mercori 30 4. 【道具】Google ADK 登場と
Socrates アーキテクチャ

Al エージェント開発を加速する ADK と、Socrates におけるその活用方法

31
| ADK の概要

e Agent Development Kit (ADK): Al エージェント開発を支援する Python /
Java フレームワーク
e 6
Google エコシステムとの高い親和性: Google Workspace、Google
Cloud 等とシームレスに連携。
o マルチエージェントアーキテクチャ設計支援: 複数の専門エージェン
トの協調を容易に実現。
o 柔軟なオーケストレーション: LLM 駆動の動的処理と、ワークフロー
ベースの静的処理を組み合わせ可能。
o 豊富なツールエコシステムと拡張性: LangChain 等の外部ライブラリ
との連携もサポー o
o 双方向ストリーミング:リアルタイムな音声・動画対話をサポー

座 mercori る
| ADK のコア構成要素 : エージェント開発の基盤

e エージェント (Agents):
o 特定のタスクを実行するために設計された基本的な「働き手」。
e ツール (Tools):

o エージェントに外部 API との連携、情報検索、コード実行、他サービ
ス呼び出しなどの機能を提供。

33
Skip

| ADK のコア構成要素 : インタラクションと状態の管理

e セッション管理 (Sessions):
o 単一の会話の文脈(Sessions) を処理。
o 会話履歴 (Events) や、会話中のエージェントのワーキングメモリ
(State) を含む。
e メモリ (Memory):
o 複数セツションにわたってユーザーに関する情報を記憶。
o セッション内の短期的な State とは異なり、長期的な文脈を提供。
e イベント (Events):
o セッション中に発生する出来事 (ユーザーメッセージ、エージェント
の返信、ツールの使用など) を表すコミュニケーションの基本単位。
o 会話履歴を形成。
e アーティファクト管理 (Artifacts):
o セッションやユーザーに関連するファイルやバイナリデータ (画像、
PDF など) の保存、読み込み、管理。
座 mercori 3

Skip

IADK のコア構成要素 : 高度な機能と実行の仕組み

e ランナー (Runner):
o 実行フローを管理するエンジン。
o Event に基づいてエージェント間のインタラクションを調整し、バッ
クエンドサービスと連携。
e コールバック (Callbacks):
o エージェントの処理プロセス内の特定のポイントで実行されるカスタ
ムコード。
o チェック、ロギング、動作の変更などが可能。
e コード実行 (Code Execution):
o エージェントがコードを実行する能力。

座 mercori 35
| Socrates との他の社内ツールとの共存関係

Socrates は、ADK を基盤としたマルチエージェントシステムとして設計。 各エー
ジェントが専門タスクを担当し、協調動作。

人 [
ーー 依頼
Socrates 二和ーー
= 1

ee 権限管理

エージェント

36
| Socrates の ADK 活用ポイント

e ADK の主要な柱と Socrates への具体的適用:
o モジュール性:目的特化型の複数のサブエージェントで構成。開発・テ
スト・改修が容易。

号 狙い:rootエージェントの肥大化防止 /テスト可能性の維持、各
専門チームへのエージェント委任による組織全体のエージェント
運用促進

o 豊富なツールエコシステム: 多数の実装済みツールと 3rd party ツール

との互換 レイヤー。
| Socrates のワークフローを ADK で設計する

e 主要な分析の進め方をステップごとに分類して、ADK で実装
o LLM Agents - 柔軟 / テキスト / 非決定論的なステップ
呈 (1.) ユーザー意図の明確化
呈 (3.) 分析計画の立案とツール選択
呈 (5.) SQL 生成 / 検証 / 反復実行
呈 (7.) 結果の統合 / 解釈 / 報告
o Tools - 厳格 / 決定論的なステップ
呈 (2.) 過去事例 / 関連知識の参照
昌 (4.) データソース探索と理解
呈 (6.) 高度な分析処理の実行

38
| Socrates と ADK Agents / Tools 活用

Agents Tools
非構造化データの処理、 外部入出力、決定論的な
思考、非決定論的なデー データタ処理
タタ処理

39
| Socrates と ADK Agents 連携 : 概要

e Socrates における ADK Agents の重要性: 全体の
構造化データの処理を行う。
e Agents の種類:

計画とタスクの分割、非

o LLM Agent: 大規模言語モデル(LLM)を活用し、複雑な推論を行う。
o Workflow Agents: 実行フローを制御する決定論的なエージェント。

呈 Sequential Agent: 順次実行
呈 LoopAgent: 反復実行
呈 Parallel Agent: 並列実行
o Custom Agents: 任意のロジックの実装。

40
| Socrates と ADK Agents 実装例 : Self-Reflection (1/2)
Sequential Agent: LLM の成果物をレビューする

アクティブユーザ数を調べるぞ

SELECT COUNTぐ
バ FRON users
hh、
このクエリは全ユーザ数を示しており、
ト4 利用者の期待と違いそう

| Socrates と ADK Agents 実装例 : Self-Reflection (2/2)
Loop Agent: 脱に落ちるまで、なぜなぜ分析を繰り返す。

なぜメルカリの売り上げが落ちている
1 のか?

Em
COそ ユーザーの利用頻度が低下している
| メルカリが相対的に魅力を失った

| 閉合が差別化機能を提供

| 半争環境の変化や市場トレンドへの敵
ブ 応が十分でない

exit_loop
)

42
| Socrates と ADK Agents 実装例 : Self-Consistency (1/2)
Parallel Agent: temperature の高い LLM Agents を用いたブレスト大会

売上増加の原因を調べるぞ

ーーカテゴリじゃね 々?

hh、 ホビ
服カテゴリの季節変動かも?
のIO!の7のkgEperin
のデ

大型キャンペーンやってなかった?

大型キャンペーンが有力です。
順に検証してみましょう。

座 mercori

43
| Socrates と ADK Agents 実装例 : Self-Consistency (2/2)
Parallel Agent を使って別な方法で同じ値を求める

ホビーカテゴリの MAU を求めるぞ

バ

BigQuery から計算

SELECT COUNT(DISTINCT user_id)
FROM transactions

WHERE category = "ホビー"

AND month = “2025-O5"

0万人

NGのDIGD7

フェルミ推定

MAU 2.900 万人
ホビーシェア 28%

ホビー MAU 圭 810 万人
(2.900 万人 \* 28%)

ヽ

乗離している、どこか間違えているか
も?

44
| Socrates と ADK Agents 実装パータン : Agentic Tools
ツールを LLM Agent で囲って、より和柔軟にツールを使用する

なぜメルカリの売り上げが落ちている
< のか調べて

売上テーブルは見つからなかったけ

hh、
ど、transactions テーブルは見つかっ
⑩】 たよ。 BigQuery の構文ドキュメントを
バ 読んでクエリを書くね。

BigQuery クエリ結果は -。

| Socrates と ADK Agents / Tools 活用

Agents Tools
非構造化データの処理、 外部入出力、決定論的な
思考、非決定論的なデー データタ処理
タタ処理

46
| Socrates と ADK ツール連携 : 概要

e Alエージェントにおけるツールの重要性: LLM の知識の限界、
限界、外部システム連携不可を補う。
e ツールの主な種類:

計算能力の

o 知識アクセス系ツール (Observing) : LLM に外部知識を提供
mm Socrates: Vertex AI RAG Engine による社内ドキュメント検索、

BigQuery テーブル定義検索

o 計算・データ処理系ツール: 数値計算、データ加工、コー

呈 Socrates: BigQuery 実行、Python コード実行

ド実行

o 外部連携・API 呼び出し系ツール (Acting) : 他システムとの連携

mm Socrates: Google ドライブ、他 API 連携

座 mercori

47
| Socrates と ADK ツール連携 : 知識アクセス系ツール

e BigQuery との対話 (ADK BigQueryToolset) :
o スキーマ参照 bigquery_tables_get を行い、テーブルのスキーマや説
明文を取得し、LLM のデータ理解を促進。
o SQL実行 bigquery_jobs_query。ADK の認証の仕組みを通じて、
ユーザー権限のセキュアなデータアクセス。
es Vertex Al RAG Engine による知識拡張 (ADKVertexAiRagRetrievaU) :
o 社内ドキュメントや BigQuery テーブルを自然言語で検索
呈 search_internal_documents(query)
呈 Search_bigquery_tables_semantic(qduery)
e メモリ保存・検索 (ADK VertexAiRagMemoryService) :
o 過去の類似分析セッションの記録・検索・再利用
呈 load_memory(query)
呈 add_session_to_memory(session)

座 mercori

48
| Socrates と ADK ツール連携 : 計算・データ処理系ツール

es Python Code Executor (ADK VertexAiCodeExecutor):

o SQLでは困難な高度なデータ処理、統計分析を実行。サンドボックス

f

ELされた安全な実行環境が鍵。

o 現状、外部パッケージの動的インストールは制限あり。

mm matplotlib でグラフを書くと、日本語が豆腐[]になる。

49
| Socrates と ADK ツール連携 : 外部連携系ツール他

e Google ドライブ系ツール (ADK DocsToolset, SheetsToolset):
o よりリッチな入出力を行い、人間が介入しやすくサポートする。
o チャットインタフェースの情報密度が低くなりやすいのを補う役割。
e 応答エージェントの変更 (ADKtransfer_to_agent)
o マルチエージェントシステムにおいて、より詳細な実装を持つエー
ジェントに応答を委任する
e Python 自作ツール (ADK FunctionTool / Agents as a tooU)
o 既存の実装では不足する機能や、ガードレール付きの振る舞い、別な
Agent へヘー時的な手伝い依頼を実現する
| Socrates と ADK ツール連携 : なぜ自作ツールが必要か

e Al エージェントにおけるツールの重要性: LLM の知識、計算能力、外部シ
ステム連携を補う。

e Socrates では多くのツールを自作。ADK の FunctionTool を活用。
o 理由1: きめ細やかなガードレールの実装:

呈 GoogleCloud の API を自作ツール内でラップ。

号 ツール実行前後のチェックに加え、 実行中の監視や介入 (例:
BigQuery の過剰なコスト予測時の実行中断) など、より厳格な
安全対策を組み込むため。

o 理由2: 品質改善サイクル:

号 RAGの検索クエリごとのヒット率などきめ細やかなログを取得

し、RAG の品質改善サイクルを回せる。
Skip

| Al エージェントのためのツール選定戦略 : 基本方針 (1/2)

e 目的からツールを選ぶ
o エージェントに「何をさせたいか ? 」を明確にし、その目的達成に必
要な機能から逆算する。
o Socrates 例 : データアナリストの業務には、BigQuery アクセス、ス
プレッドシート作成、ドキュメント検索が必要。
es LLMに手続きをさせる、知識を披露させない
o エージェントに必要な知識は、ツール、プロンプトで全て与える。
エージェントの知識を信用しない。
Skip

IAl エージェントのためのツール選定戦略 : 基本方針 (2/2)

実現可能性 / 既存資産を活用できないか考える

o 社内に利用可能なAPIl、ライブラリ、データソースがないか確認。

o Socrates 例 : Basic Tables、監査ログ

プロンプトで対応できないか考える

o 知識アクセス系のツールの場合は、プロンプトに知識を書いて、ツー
ルとして実装しない方針も検討する。

信頼性と検証可能性を評価する
o ツールの安定性、エラーハンドリングの容易さ、品質確認のしやすさ
を考慮。

セキュリティとガバナンスを評価する
o 権限は必要十分か ? 機密情報の取り扱いは適切か ?
o 場合によっては、ログやガードレールを含めて自作する

座 mercori 63 5. 【学びの軌跡】 エコシステム構築の
戦略
Socrates 内大因誠 Alエージェントを育む環境の重要

54
| 技術選定の道のり : LangGraph から ADK へ

es LangGraph からの出発 (2025 年 3 月) : 「自律的に思考・行動する
エージェント」に着目し、プロトタイピングを実施。高品質データマート
「Basic Tables」が成功の鍵。2 日でデモ版リリース。
e LangGraph から ADK への移行に期待したこと
o Google エコシステムとのネイティブ連携
号 Google Drive や BigQuery / Vertex AI Search などの強力なツール

との連携
mm Vertex Al Agent Engine / Google Agentspace による運用監視へ
の期待

o LangGraph の若干の手間の解消
mm LangGraph Runnable#Stream が、応答を配列とスカラ値、それ
ぞれで返すことがあり、ハンドリングが燃雑

座 mercori 55
Skip

| Socrates を育むエコシステム : チーム

チームの連携 ・理

部門横断的な開発・運用体制とフィードバックループ
o 利用状況モニタリング、ユーザーヒアリング、エラーログ分析、

Agent as a Judge を通じて、プロンプトやツールの迅速な改善を実施

フィードバック

た

Data チーム

e メタデータの改善

e データ加工の改善

e 権限管理プロセスの改善

BI チーム
e 分析ドキュメントの改善
es Agent asaJudge の改善

56
Skip

| Socrates を育むエコシステム : データ

e 2 整備されたデー人タ資産
o 高品質データマート「Basic Tables」がSocratesの分析能力の源泉。
e カスタムデータカタログの構築と運用
o BigQuery 監査ログから、テーブル定義、生成方法、利用状況を収集
・解釈し、用途とテーブルの対応表を整備。
o Vertex Al RAG Engine と連携し、用途からテーブル検索を可能に。
o メ " ッ ト:
下 ータカタログでヒットしないマイナーテーブルをカバー
e 精度は semantic ayer人などでカバー
号 評価と改善サイクルの実現: 検索クエリや利用状況を分析し、カ
タログの記述や構造を継続的に改善。
Skip

| Socrates を育むエコシステム : ドキュメント

e Machine Readable なドキュメントとナレッジベースの重要性
o テーブル定義書、ビジネス用語集、分析手順書、過去の Q&A、施策カ
レンダーなどを RAG 用に整備。
o 課題:人間にとって書きやすく、かつびつ機械にとっても読みやすいド
キュメントをどう増やすか。
号 対策:ドキュメント作成のインセンティブ設計、ドキュメントテ
ンプレート、LLM による記述支援。
o 将来構想: Socrates が GitHub リポジトリを DeepWiki のような仕組
みを介して検索し、データ生成プロセスを理解する。
e 技術だけでなく、Al エージェントを業務に組み込み、共に成長していくた
めの運用体制と組織文化の醸成が重要

座 mercori 58 6. 【実践知】 エンタープライズ Al
エージェント連用のリアル

Al エージェントを本番環境で安定稼働させるための課題と、Socrates での具
体的な取り組み

59
IAl エージェント運用のリアル : 課題と対策 (導入)
MLOps 同様、Al エージェントシステムは複雑で「運用」が重要かつ困難。

(図は Hidden TechnicaLDebt in Machine Learning Systems より引用)

Configuration

Data Collection

ML
Code

Feature
Extraction

Machine
Resource
Management

Analysis Tools

Process
Management Tools

Serving
Infrastructure

Monitoring

60
| Al エージェント運用のリアル : 課題と対策 (1/4)

- LLM エージェント評価の難しさとアプローチ:
  o 課題: 非決定論的で「正しさ」の定義が曖昧。評価すべき側面も多岐

(ツール連携、 長期記憶、 対話の流れ) に渡る。 口 ングセ ッションの

テストは特に困難。
o 評価:

呈 オフライン評価 (ADK Evaluation 活用): 事前定義された評価デー
タセットでツール呼び出しや引数の妥当性確認。

呈 オンライン評価 (Human-in-the-Loop): ユーザーからの直接
フィードバック。

mm AgentasaJudge: 別のエージェントが、Socrates の応答品質や
セッション全体の妥当性を評価。特にロングセッションの E2E テ
ストに効果を発揮。

品 ダッシュボード: 重要メトリクスをダッシュボードで可視化。

座 mercori 同
| Al エージェント運用のリアル : 課題と対策 (2/4)

e LLM エージェント評価の難しさとアプローチ (続き) :
o 改善:
呈 プロンプト更新: 各種評価をもとに、より人間のためになる手順
に近づくようにプロンプトを更新。
号 ツール更新: LLM が使いづらいと感じているツールは、ドキュメ
ントやメタデータ、ユースケース例を追加したり、ツール自体を
分割する。
o 当厳密な決定論的テストは困難。 セッションレベルの達成度や品質を
多角的に検証し、継続的な評価と改善ループを回すことが重要。

座 mercori 62
| Al エージェント運用のリアル : 課題と対策 (3/4)

e レイテンン:
o 課題: 高速とは言えない。Gemini 2.5 Pro への問い合わせと同程度。
一間一和客ではないため、人間がidle になる時間が長くなりつつある。

o 対策:
号 ストリーミング応答、非同期処理による体感速度向上、 ユーザー
への進捗表示。

号 高速なモデル (Gemini 2.0 Flash) と選択。

63
| Al エージェント運用のリアル : 課題と対策 (4/4)

e コスト最適化:
o 課題:LLM API コール数、 トークン消費量などが想定以上に膨らむリ
スク。
o 対策:ADK の Gemini 呼び出し回数調整、ワークフロー最適化、
BigQuery コストガードレールの策定。
e セキュリティとガバナンス:
o 課題: プロンプトインジェクション、機密情報漏洩、意図しないエー
ジェントの行動 (データ破壊、誤ったデータの薔積・拡散) 。
o 対策:ツール実行スコープの最小化。ある程度の社内リスクは受け入れ
つつ、入力サニタイズ・出力フィルタリングなどのガードレールを実
』二

球o

座 mercori 還
| ADK の評価 : 実際に使ってみて良かった点
e 良かった点 (Socrates 開発における実感):

O
O

O O OO O

全体と してよくできている

Google エコシステムとの強力なネイティブ連携: Vertex Al, BigQuery
等とのシームレスな統合が開発を加速。

サンプルコードの充実: adk-samples リポジトリが充実。
デバッグが簡単: コードが小さく、問題筒所の特定や修正が容易。
単純な Evaluation が簡単: 単純なテストは ADK Evaluation で完結。
画像 / 音声対応も簡単: ファイルを添付して、Agent に送るだけ。
Vertex Al IAgent Engine への期待: マネージドな本番環境への移行パ
スの安心感。 ーリングやインフラ管理の負担軽減を期待。

座 mercori 65
是

敵

| ADK の評価 : 苦労した点・

e 苦労した点・課題 (解決済み)
o バグ: v0.1.0 から一部のエラーハンドリングが弱かった。v1.0.0 の今

は大部分が改善。

互換切り: v.0.1.0 から見ると、DatabaseSessionService のデータス
キーマ変更、async 関数化などの互換性がない変更があった。

e 苦労している点 (未解決)

Session Service 周りの課題: json.dumps できないオブジェクトが含
まれる Event が応答されると、Database や Agent Engine Sessions

に保存できず、エラーになる。

O

O

66
| ADK の評価 : LangGraph の強み

e 既存の応用的なオープンソースソフトウェアの参照: Deep Research など
丸ごとコピーして動かしたい時に便利。ADK の実装はまだ少ない。

e 複雑なワークフローの実装: LangGraph は複雑なグラフ構造をワークフ
ローとして定義できる。ADK は「順次」と「反復」の手続きのみ。

67 7. 【未来展望】ADK の進化への期待
IADK へのフィードバックと期待

e SessionService と MemoryService の機能拡充と外部連携強化: 多様な永
続化ストア対応 (Cloud Spanner, Firestore 等) 、複雑なデータ型シリア
ライズ標準化、Secret Manager 連携、長期記憶ソリューション。

e ツール呼び出しの堅宇性と柔軟なエラーハンドリング機構'リトライボポリ
シー、フォールバックの実装支援。ツール実行時の権限管理・監査ログ標
準化。 (+ Gemini の malformed_function_call 対策)

ゃ テスト・評価フレームワークの充実 (ADK Evaluation のさらなる進化):
エージェント振る舞い・応答品質の体系的 / 効率的な評価フレームワー
ク、マルチエージェント協調 / 全体タスク達成度評価手法。
| エコシステムへの展望

e Google Agentspace / Vertex AI Agent Garden への期待

o エージェントシェアリング: 社内外の専門エージェントを共有
e Vertex Al Agent Engine への期待

o 多様な Artifact Service のサポート

o MemoryService のサポート

o 利用者 Authorization のサポート

o SessionService への評価フレームワークの組み込み

8.【まとめ】成功の鍵と教訓

本日の発表のまとめと、AIエージェント開発とADK活用に向けたメッセージ

71
| ADK 活用の勘所と Al エージェント開発成功への教訓

e AlエージェントはLLM をコアとする複雑な「システム」
e Alエージェントは「作って終わり」ではなく、「育て続ける」もの
o 「構造化 / 非構造化データ」などの周辺資産も対象
o 「組織」や「プロセス」の変革も伴う
e Alエージェントのはじめ方
o ユーザー提供価値の確認
o スモールスタートと反復的改善
o エージェントの能力拡張のためのツール設計
o 運用の覚悟

7み
| 2025-06-10 現在、Al エージェントを開発すべきか ?

以下の条件を全て満たすなら Yes
e PoC時点の LLMs の能力でも、十分に高い価値を提供できる
e 代替手段が現実的でない (ソフトウェア化、人力化、省力化、廃止)
e 保守し続ける覚悟がある
e 時が来たら捨てる覚悟がある

73
| 参考資料・リソース

es Agent Development Kit

@ itHub - k-pvthon

e GitHub - google/adk-samples

e Speaker Deck - 1日50万件貯まるクエリのログを活かして、SOLの生成に
挑戦している話

es Hidden TechnicaLDebtin Machine Learning Systems

74

# URL Scraping Agent — README.md

このドキュメントは **URL を受け取り、ウェブページから「メタデータ」「要約」「本文 (Markdown)」を抽出し、1 つの Markdown ファイルに保存するエージェント** の手順書兼ルールブックです。エージェントはインターネットへ自由にアクセスできる前提で記述しています。

---

## 1. 目的

- **再現性 & 検索性**：取得物を決まった場所・統一フォーマットで保存し、後から機械的に再利用できるようにする。
- **最小限の加工**：元 HTML を Markdown 化しつつ、解釈 (メタデータ・要約) を明確に分離。
- **タグ駆動**：必ず `codex` タグを含め、後のクエリーやフィルタを容易にする。

---

## 2. ディレクトリ構成

```
repo-root
└── Summary
    └── 2025
        └── 06
            ├── openai.com
            │   └── 2025-06-04_chatgpt.md
            └── nytimes.com
                └── 2025-06-01_nvidia-ai.md
```

> **Note**: ドメイン名直下に日付プレフィックス付きの単一ファイルを置く方針です。異なる命名ポリシーがあれば適宜置換してください。

---

## 3. 出力フォーマット

`{date}_{title}.md`

以下のテンプレートを参考にしてください。

```md
<!-- metadata -->

- **title**: <タイトル>
- **source**: <URL>
- **author**: <著者名 / ドメイン名>
- **published**: <公開日時 (ISO 8601)>
- **fetched**: <取得日時 (ISO 8601)>
- **tags**: codex, <関連タグをカンマ区切りで追加>
- **image**: <OGP 画像やアイキャッチ URL>

## 要約

<ここに日本語の要約を書く>

## 本文

<HTML→Markdown 変換済み本文をそのまま貼り付ける>
```

> **Note**: 同じ URL の場合は更新(上書き)してください。

### 3.1 ヘッダー

- author が見つからなければドメイン名を入力すること。
- **tags**: codex の他に関連するタグが必要。
- image の URL が長くてエラーが出る場合は空にすること。

> **Note**: 1 行目に `<!-- metadata -->`、2 行目以降に **Markdown 箇条書き**で key-value を並べる。解析ツール側で行頭 `- **key**:` パターンをパースすれば機械処理も容易。

### 3.2 要約

- **日本語** で回答すること。
- 筆者が伝えたいことを全て含めてください。
- あなたが一番理解しやすい形にまとめること。短すぎるのはNG。内容が頭に入ってこないから。
- 改行で文章を区切らないでください。
- 重要キーワードは **bold** で強調。
- 300文字以上500文字以内に調整すること。足りなかった場合に文章を変えずに付け足す行為はチートなので禁止、再生成してください。

### 3.3 本文

- HTML→Markdown 変換は readability-lxml + markdownify などで自動化し、不要なナビゲーション要素を極力除去してください。
- 最後に本文が全て取得できたか確認することを忘れないでください。
- 本文を上から順番に照らし合わせて確認してください。

⸻

## 4. 処理フロー

    1. Input: エージェントに URL が渡される。
    2. Fetch: HTTP GET。必要に応じて Headless browser で JS レンダリング。
    3. Parse:
    - {title}, {meta} 各種, OGP, {time} 等を抽出。
    - 取得できない項目は空文字列。tags には必ず codex を入れる。関連タグも必ず追加してください。
    4. Convert: 本文 HTML を Markdown に変換。
    5. Assemble: メタデータ → 要約 → 本文 の順で 1 ファイルに結合。
    6. Save: Summary/YYYY/MM/{domain}/{YYYY-MM-DD}_{title}.md に保存。
    7. 各種テストと prettier を実行し、エラーが出る場合はの修正を行う
    8. Commit: git add → git commit -m "Add clip: <title or domain>"。
    9. Repeat: 次の URL へ。

⸻

## 5. 命名・タグ規約

- ファイル名: {YYYY-MM-DD}\_{title}.md
- 必須タグ: codex
- 関連タグ: ソーシャルブックマークなどで使われる、調査したコンテンツの内容を的確に表現する、15個以下の複数のタグからなる文字列にすること。
- タグ名は必ず英語にすること。

⸻

## 6. Prettier の実行

全体の Markdown やコードを整形する場合は node_tools/run_prettier.js を使いましょう。
個別にでチェックすることも可能。その場合は以下のコマンド↓

```bash
npx prettier --write <file globs>
```

⸻

## 7. 注意事項

- robots.txt を尊重。スクレイピング禁止サイトは除外。
- JS レンダリング必須サイトは Headless browser (e.g. Playwright) を使用。
- 著作権・ライセンスを確認し、引用の範囲に収める。

⸻

Happy clipping! 🚀
